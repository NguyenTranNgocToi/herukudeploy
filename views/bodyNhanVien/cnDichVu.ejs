
<style>
    .table-striped{
        width: 100%;
    }
    .table-striped tbody{
        width: 100%;
        height: 440px;
        overflow-y: auto;
    }
    .table-striped thead, tbody,tr{
        display: block
    }
    .table-striped td,th{
        width: 150px;
    }

    .table-striped2{
        width: 600px;
    }
    .table-striped2 tbody{
        width: 100%;
        height: 440px;
        overflow-y: auto;
    }
    .table-striped2 thead, tbody,tr{
        display: block
    }
    .table-striped2 td,th{
        width: 200px;
      
    }

</style>
<div class="row" style="font-family: 'Times New Roman', Times, serif;font-weight: bold;">
<div class="col-sm-12"> 
        <h1 style="text-align: center"><b>CHI TIẾT PHÒNG: <%=list[0].maPhong%></b></h1>
</div>
</div>
<div class="row" style="font-family: 'Times New Roman', Times, serif;margin-left: 100px;">
    <div class="col-sm-6"> 
        <h4><b>Tên khách hàng đang thuê phòng:</b> <%=list[0].tenKH%></h4>
    </div>
    <div class="col-sm-6"> 
            <h4><b>Ngày bắt đầu thuê:</b><%=list[0].ngayNhanPhong.getFullYear().toString()%>/<%=(list[0].ngayNhanPhong.getMonth()+1).toString()%>/<%=list[0].ngayNhanPhong.getDate().toString()%>(<%=list[0].ngayNhanPhong.getHours().toString()%>:<%=list[0].ngayNhanPhong.getMinutes().toString()%>)
            </h4>
    </div>
    <div class="col-sm-6"> 
        <h4><b>Thời gian đã ở:</b> <%= day%>(ngày)</h4>
    </div>
    <div class="col-sm-6"> 
        <h4><b>Ngày sẽ trả phòng:</b><%=list[0].ngayTra.getFullYear().toString()%>/<%=(list[0].ngayTra.getMonth()+1).toString()%>/<%=list[0].ngayTra.getDate().toString()%>(<%=list[0].ngayTra.getHours().toString()%>:<%=list[0].ngayTra.getMinutes().toString()%>)
        </h4>
    </div>
 
</div>

<div id="gd1" >
    <div class="row">
        <div class="col-sm-5" style="margin-left: 100px;">
            <h3  style="text-align: center;">DANH SÁCH CÁC DỊCH VỤ CỦA KHÁCH SẠN</h3>
            <div class="col-sm-12" style=" margin-left:0.2%; height:510px">
                <table class="table table-striped" style="border:1px solid black" id="table1">
                        <thead >
                          <tr>
                            <th>Dịch vụ</th>
                            <th>Loại dịch vụ</th>
                            <th>Thành tiền</th>
                            
                            <th></th>
                            
                          </tr>
                        </thead>
                        <tbody id="bodytable1">
                            <!-- <tr>
                                    <td>cocaTest</td>
                                    <td>20000vnđ</td>
                                    <td>  
                                        <button type="button" class="btn"
                                        style="background-color: green;color: aqua;">thêm</button> </a>
                                    </td>
                                    
                            </tr>  -->
                            <%for(let i=0;i< list1.length;i++){%>
                                <tr id="idrow<%=list1[i].maDichVu%>">
                                    <td><%=list1[i].tenDichVu%></td>
                                    <td style="padding-left: 15px;"><%=list1[i].tenLoaiDichVu%></td>
                                    <td style="padding-left: 25px;"><%=list1[i].donGia%></td>
                                    <td>  
            
                                        <button type="button" class="btn" onclick="themDichVu('<%=list1[i].maDichVu%>','<%=list1[i].tenDichVu%>',' <%=list1[i].tenLoaiDichVu%>','<%=list1[i].donGia%>','idrow<%=list1[i].maDichVu%>')"  id="button<%=list1[i].maDichVu%>" >Chon</button>
                                    </td>
                                    
                                    </tr> 
                                <%}%>
        
                        </tbody>
                      </table>
        </div>
        </div>
    
    <div class="col-sm-5">
        <h3  style="text-align: center;">DANH SÁCH CÁC DỊCH VỤ PHÒNG ĐÃ SỬ DỤNG</h3>
        <div class="col-sm-12" style=" margin-left:0.2%; height:510px">
            <table class="table table-striped" style="border:1px solid black" id="table2">
                <thead >
                  <tr>
                    <th>Dịch vụ</th>
                    <th>Loại dịch vụ</th>
                    <th>Số lượng</th>
                    
                    <th></th>
                    
                  </tr>
                </thead>
                <tbody id="bodytable2">
                   
                   
                        <!-- <tr id="idrow">
                            <td>Coca</td>
                            <td> Nước Uống</td>
                            <td><input type="number" id="tentacles" name="tentacles"
                                min="1" value="1" style="width: 50px;"></td>
                            <td>  
        
                                <button type="button" class="btn" onclick="xoaDichVu()"  id="button" >Xóa</button>
                            </td>
                            
                        </tr>  -->
                        <%for(let i=0;i< list2.length;i++){%>
                            <tr id="idRowB<%=list2[i].maDichVu%>">
                                <td><%=list2[i].tenDichVu%></td>
                                <td><%=list2[i].tenLoaiDichVu%></td>
                                <td style="padding-left: 20px;"><input type="number" id="tentacles" name="tentacles"
                                    min="1" value="<%=list2[i].soLuong%>" style="width: 50px" onchange="resetMess()"></td>
                                <td>  
            
                                    <button type="button" class="btn" onclick="xoaDichVu('idRowB<%=list2[i].maDichVu%>')"  id="button" >Xóa</button>
                                </td>
                                
                            </tr> 
                        <%}%>
                </tbody>
              </table>
        </div>
    </div>
    
    </div>
    <div class="row">
        <div class="col-md-12">
        <!-- <button type="button" class="btn btn-success" style="margin-left: 0%" onclick="traphong('<%=list[0].maPhong%>')">Trả Phòng</button> -->
        <button type="button" class="btn btn-primary" style="margin-left: 74%;width: 100px;" onclick="luu()">Lưu</button>
        <a href="/nhanvien/cnthuephong"><button type="button"
           style="width: 100px;" class="btn">Thoát</button> </a>
        </div>
        <p id="messId" style="margin-left: 75%; font-weight: 900; font-family: 'Helvetica Neue';;" ><%=mess%></p>
    </div>
    
</div>
<div id="gd2" style="display: none;">
    <div class="row">
        <div class="col-sm-12">
            <h3  >Danh sách các phòng đang thuê của <%=list[0].tenKH%></h3>
            <div class="col-sm-8" style=" margin-left:0.2%; height:510px">
                <table class="table table-striped2" id="table1" style="border: 2px solid #b1154a;border-radius:15px;">
                        <thead >
                          <tr>
                            <th>Mã Phiếu Thuê</th>
                            <th>Mã Phòng</th>
                            <th>Ngày Đặt Phòng</th>
                            
                            <th></th>
                            
                          </tr>
                        </thead>
                        <tbody id="bodytable3">
                                <!-- <tr id="">
                                    <td>list1[i].tenDich</td>
                                    <td>list1[i].tenLoai</td>
                                    <td>list1[i].donGia</td>
                                    <td>  
                                          <input type="checkbox" id="" name="" value="true">
                                    </td>
                                </tr>  -->
                   
                        </tbody>
                      </table>
        </div>
        </div>
    </div>
 
    <div class="row" style="margin-top: 5%">
        <div class="col-md-12">
        <button type="button" class="btn btn-success" style="margin-left: 0%" onclick="thanhToan()">Thanh Toán</button>
        <button type="button" class="btn btn-info" style="margin-left: 45%" onclick="quayLai()">Quay Lại</button>
    </div>
   
</div>

<form action="/nhanvien/cnthuephong/cndichvu/<%=list[0].maPhong%>" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <input type="text" class="form-control" id="listDichVu" name="listDichVu" required style="display: none;">
    </div>
    <div class="form-group">
        <input type="text" class="form-control" id="listSoLuongDichVu" name="listSoLuongDichVu" required style="display: none;">
    </div> 
    <div class="form-group">
        <button type="submit" id="luu" class="btn btn-default" required style="display: none;">Lưu</button>
    </div>
    <!-- style="display: none;" -->
   
</form> 

<form action="/nhanvien/cnthuephong/thanhtoan" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <input type="text" class="form-control" id="listmaphong" name="listmaphong" required style="display: none;">
    </div>
    <div class="form-group">
        <button type="submit" id="tt" class="btn btn-default" style="display: none;">Lưu</button>
    </div>
</form> 






<script>
  
    function themDichVu(madv,tendv,loaidv,dongia,rowtable){
        //  console.log(madv);
        //  console.log(tendv);
        //  console.log(rowtable);
        resetMess()
        var table = document.getElementById("bodytable2");

        var countrow =  table.rows.length;
        
        var row3 = document.getElementById("idRowB"+madv)
        if(row3 == null){
            var row = table.insertRow(countrow);
        row.id ="idRowB"+madv;
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        cell1.innerHTML = tendv;
        cell2.innerHTML =loaidv;
        cell3.innerHTML ="  <td><input type=\"number\" id=\"tentacles\" name=\"tentacles\" min=\"1\" value=\"1\" style=\"width: 50px;\" onchange=\"resetMess()\"></td>";
        cell4.innerHTML =" <td><button type=\"button\" class=\"btn\" onclick=\"xoaDichVu('idRowB"+madv+"')\">Xóa</button> </td>";
        }
       
   
     }
    function xoaDichVu(rowtable){
        resetMess()
        // var table = document.getElementById("bodytable1");
        //  var countrow =  table.rows.length;
        //  console.log("table2");
        //  console.log(countrow);
        //  var row = table.insertRow(countrow);
        //  row.id ="idrow"+madv;

        //  var cell1 = row.insertCell(0);
        // var cell2 = row.insertCell(1);
        // var cell3 = row.insertCell(2);
        // var cell4 = row.insertCell(4);
     
        var idRowB = rowtable
        // console.log("idRowB"+idRowB);
        var rowt1 = document.getElementById(idRowB);
        // console.log("idRow1:"+idrow1);
        rowt1.parentNode.removeChild(rowt1);


     }
    function luu(){
        var table = document.getElementById("bodytable2");
        var listDichVu =""
        var soLuong =""
     
        var rows = table.getElementsByTagName('tr');
        // var strin1g = document.getElementById("bodytable2").rows[1].cells[2].getElementsByTagName("input")
        // console.log(strin1g[0].value);
        if(rows.length>0 ){
            for ( var i = 0; i < rows.length; i++) {
           
             if(i< (rows.length-1)){
                listDichVu = listDichVu + document.getElementById("bodytable2").rows[i].cells[0].innerHTML+"-"

                var strin1g = document.getElementById("bodytable2").rows[i].cells[2].getElementsByTagName("input")
                soLuong =  soLuong + strin1g[0].value+"-"
                // console.log("so Luong"+ soLuong);
             } else{
                listDichVu = listDichVu + document.getElementById("bodytable2").rows[i].cells[0].innerHTML
                var strin1g = document.getElementById("bodytable2").rows[i].cells[2].getElementsByTagName("input")
                soLuong =  soLuong + strin1g[0].value
             }  
           
          }
            document.getElementById("listDichVu").value = listDichVu
            document.getElementById("listSoLuongDichVu").value = soLuong
            document.getElementById("luu").click();
        }else if(rows.length<=0){
            document.getElementById("listDichVu").value = -1
            document.getElementById("listSoLuongDichVu").value = -1
            document.getElementById("luu").click();
        }
    }
    function resetMess(){
        document.getElementById("messId").innerHTML="Chưa Lưu"
    } 
    function traphong(maPhong){
        var settings = {
                url: "/nhanvien/cnthuephong/chothue/getlistthanhtoan/"+maPhong,
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    for (var phong of data) {
                        renderTable3(phong)
                    }
                }
                    
            }
        $.ajax(settings);
        var div1 = document.getElementById("gd1").style.display = "none";
        var div2 = document.getElementById("gd2").style.display = "";

   }
    function quayLai(){
    var div1 = document.getElementById("gd1").style.display = "";
        var div2 = document.getElementById("gd2").style.display = "none";
   }
    var testPhong = {
        maPhong: "0002",
        tenLoaiPhong: "Phòng Đơn",
        ngayDatPhong: "2/9/2022 15:00",
    };
    function renderTable3(phong) {
      
       var x = phong.ngayDat
     x = x.replace("T", " ");
     var result = x.substring(0, x.length - 5);
    //  alert(x)
        var temp =
            "<tr id=\"idrow" + phong.maPhong + "\">" +
            "<td>" + phong.maPhieu + "</td>"+
            "<td>" + phong.maPhong + "</td>" +
            "<td>" + result+"</td>"
            + "<td>"
            + " <input type=\"checkbox\" id=\"radio"+phong.maPhong+"\" name=\"\" value=\"true\">" +
            "</td>" +
            "</tr>"
            // alert("render")
                                    
        var temps = $('#bodytable3');
        $(temp).appendTo(temps);
        
       
    }
    function thanhToan() {
        var table = document.getElementById("bodytable3");
        var string=""
        var rows = table.getElementsByTagName('tr');
      

        if (rows.length > 0 ) {
            for (var i = 0; i < rows.length; i++) {
              
                if (i < (rows.length - 1)) {
                    if(document.getElementById("radio"+document.getElementById("bodytable3").rows[i].cells[1].innerHTML).checked == true) 
                        string = string + document.getElementById("bodytable3").rows[i].cells[1].innerHTML + "-"
                   
                } else {
                    if(document.getElementById("radio"+document.getElementById("bodytable3").rows[i].cells[1].innerHTML).checked == true) 
                        string = string + document.getElementById("bodytable3").rows[i].cells[1].innerHTML
                    document.getElementById("listmaphong").value = string
                    document.getElementById("tt").click();
                }
               
            }
           
        } 
    }


</script>